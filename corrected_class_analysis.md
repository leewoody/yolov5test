# 修正後的類別分析報告

## 🔍 重要發現：數據集結構真相

### 原始數據集結構 (Regurgitation-YOLODataset-1new)
根據 `three_class_examples.md` 的分析，原始數據集包含：

#### 檢測類別 (Detection Classes)
- **AR**: Aortic Regurgitation (主動脈反流)
- **MR**: Mitral Regurgitation (二尖瓣反流)  
- **PR**: Pulmonary Regurgitation (肺動脈反流)
- **TR**: Tricuspid Regurgitation (三尖瓣反流)

#### 分類類別 (Classification Classes)
- **PSAX**: Parasternal Short-Axis View (胸骨旁短軸視圖) - `0 0 1`
- **PLAX**: Parasternal Long-Axis View (胸骨旁長軸視圖) - `0 1 0`
- **A4C**: Apical Four-Chamber View (心尖四腔視圖) - `1 0 0`

### 轉換後數據集結構 (converted_dataset_fixed)
我們的轉換腳本將**視角分類**轉換為**反流類型分類**：

#### 轉換邏輯
- 原始分類標籤 (PSAX, PLAX, A4C) → 轉換為反流類型標籤 (AR, MR, PR, TR)
- 基於檢測框的 class_id 來確定反流類型

## 📊 實際類別分布統計

### 轉換後數據集的真實分布

| 類別 | 訓練集樣本數 | 測試集樣本數 | 總樣本數 | 佔比 |
|------|--------------|--------------|----------|------|
| **AR** | 92 | 106 | 198 | 17.40% |
| **MR** | 442 | 57 | 499 | 43.85% |
| **PR** | 298 | 143 | 441 | 38.75% |
| **TR** | 0 | 0 | 0 | 0.00% |

### 關鍵發現

#### 1. **TR 類別完全缺失**
- **原因**: 原始數據集中沒有 TR (三尖瓣反流) 的樣本
- **影響**: 模型無法學習 TR 類別的特徵
- **解決方案**: 需要收集 TR 樣本或調整模型架構

#### 2. **類別不平衡問題**
- **不平衡比例**: 2.52:1 (MR vs AR)
- **MR 類別**: 樣本最多，訓練充分
- **AR 類別**: 樣本最少，訓練不足

#### 3. **數據集分布問題**
- **AR 類別**: 測試集樣本 (106) 多於訓練集樣本 (92)
- **PR 類別**: 測試集比例過高 (32.4%)
- **缺乏驗證集**: 所有類別都沒有驗證集

## 🎯 模型表現分析

### 實際表現與樣本數量的關係

#### 1. **MR (二尖瓣反流) - 表現最佳 (82.46%)**
- **樣本充足**: 499 個樣本
- **訓練充分**: 442 個訓練樣本
- **分布合理**: 88.6% 用於訓練

#### 2. **PR (肺動脈反流) - 表現中等 (71.33%)**
- **樣本充足**: 441 個樣本
- **訓練樣本**: 298 個
- **問題**: 測試集比例過高 (32.4%)

#### 3. **AR (主動脈反流) - 表現較差 (58.49%)**
- **樣本不足**: 僅 198 個樣本
- **訓練不足**: 僅 92 個訓練樣本
- **關鍵問題**: 測試樣本多於訓練樣本

#### 4. **TR (三尖瓣反流) - 無法分類 (0.00%)**
- **樣本缺失**: 0 個樣本
- **根本問題**: 數據集中完全沒有此類別

## 🔧 數據集問題分析

### 1. **轉換邏輯問題**
```
原始數據集:
- 檢測: AR, MR, PR, TR (反流類型)
- 分類: PSAX, PLAX, A4C (視角類型)

轉換後數據集:
- 檢測: AR, MR, PR, TR (反流類型) 
- 分類: AR, MR, PR, TR (反流類型) - 重複了！
```

### 2. **數據重複問題**
- 檢測任務和分類任務現在都是相同的類別
- 失去了多任務學習的意義
- 應該保持檢測和分類的不同目標

### 3. **TR 樣本缺失**
- 原始數據集中就沒有 TR 樣本
- 轉換後仍然沒有 TR 樣本
- 需要額外收集 TR 數據

## 💡 修正建議

### 1. **重新設計數據集結構**
```
建議的數據集結構:
- 檢測任務: AR, MR, PR, TR (反流類型)
- 分類任務: PSAX, PLAX, A4C (視角類型)
- 保持多任務學習的意義
```

### 2. **數據收集策略**
```
優先級 1: 收集 TR 樣本
- 目標: 至少 100-200 個 TR 樣本
- 來源: 醫學影像數據庫、醫院合作

優先級 2: 平衡 AR 樣本
- 目標: 增加 AR 樣本至 300-400 個
- 方法: 過採樣、數據增強、額外收集
```

### 3. **模型架構調整**
```
針對缺失類別 (TR):
- 使用遷移學習
- 考慮多標籤分類
- 調整損失函數

針對不平衡問題:
- 使用 Focal Loss
- 實施過採樣
- 調整類別權重
```

### 4. **評估策略調整**
```
- 分別評估檢測和分類性能
- 使用混淆矩陣分析每個類別
- 監控每個類別的單獨準確率
- 考慮使用 F1-score 而不是準確率
```

## 📈 預期改進效果

### 短期目標 (1-2 週)
- **AR 準確率**: 58.49% → 70%+
- **整體準確率**: 提升 5-10%

### 中期目標 (1 個月)
- **收集 TR 樣本**: 100-200 個
- **TR 準確率**: 達到 60%+
- **所有類別**: 達到 75%+ 準確率

### 長期目標 (2-3 個月)
- **整體準確率**: 達到 85%+
- **類別平衡**: 所有類別準確率差異 < 10%
- **多任務學習**: 檢測和分類任務都達到良好性能

---

**結論**: 當前模型表現反映了數據集的真實分布。MR 表現最好是因為樣本充足，AR 表現較差是因為樣本不足，TR 無法分類是因為完全沒有樣本。需要通過數據收集和模型優化來改善整體性能。 