# YOLOv5 æ¨™ç±¤æ ¼å¼åˆ†æå ±å‘Š

## æ¦‚è¿°

æœ¬å ±å‘Šåˆ†æäº†ä¸‰å€‹æ•¸æ“šé›†çš„æ¨™ç±¤æ ¼å¼ï¼Œç™¼ç¾äº†é‡è¦çš„æ ¼å¼ä¸ä¸€è‡´å•é¡Œï¼Œé€™å¯èƒ½æ˜¯å°è‡´åˆ†é¡æå¤±å½±éŸ¿æª¢æ¸¬æº–ç¢ºåº¦çš„æ ¹æœ¬åŸå› ã€‚

## æ•¸æ“šé›†åˆ†æçµæœ

### 1. **demo æ•¸æ“šé›†**
- **ç¸½æ–‡ä»¶æ•¸**: 18
- **æª¢æ¸¬æ ¼å¼**: YOLO æ¨™æº–æ ¼å¼ (100%)
- **åˆ†é¡æ ¼å¼**: ç©ºæ ¼åˆ†éš”æ ¼å¼ (100%)
- **é¡åˆ¥æ•¸**: 2 (`ASDType2`, `VSDType2`)
- **ç‹€æ…‹**: âœ… æ ¼å¼ä¸€è‡´

**æ¨™ç±¤æ ¼å¼ç¤ºä¾‹**:
```
0 0.4765625 0.5875 0.22734375 0.3734375
0 0 1
```

### 2. **demo2 æ•¸æ“šé›†**
- **ç¸½æ–‡ä»¶æ•¸**: 18
- **æª¢æ¸¬æ ¼å¼**: YOLO æ¨™æº–æ ¼å¼ (100%)
- **åˆ†é¡æ ¼å¼**: Python åˆ—è¡¨æ ¼å¼ (100%)
- **é¡åˆ¥æ•¸**: 2 (`ASDType2`, `VSDType2`)
- **ç‹€æ…‹**: âœ… æ ¼å¼ä¸€è‡´

**æ¨™ç±¤æ ¼å¼ç¤ºä¾‹**:
```
0 0.4765625 0.5875 0.22734375 0.3734375
[0, 0, 1]
```

### 3. **Regurgitation-YOLODataset-1new æ•¸æ“šé›†**
- **ç¸½æ–‡ä»¶æ•¸**: 1042
- **æª¢æ¸¬æ ¼å¼**: åˆ†å‰²æ ¼å¼ (100%)
- **åˆ†é¡æ ¼å¼**: ç©ºæ ¼åˆ†éš”æ ¼å¼ (99.8%) + ç„¡åˆ†é¡ (0.2%)
- **é¡åˆ¥æ•¸**: 4 (`AR`, `MR`, `PR`, `TR`)
- **ç‹€æ…‹**: âŒ æ ¼å¼ä¸ä¸€è‡´

**æ¨™ç±¤æ ¼å¼ç¤ºä¾‹**:
```
0 0.4120050282840981 0.36064189189189194 0.6634192331866751 0.36064189189189194 0.6634192331866751 0.5475084459459459 0.4120050282840981 0.5475084459459459
0 0 1
```

## é—œéµå•é¡Œè­˜åˆ¥

### ğŸ”´ **åš´é‡å•é¡Œ**

#### 1. **æª¢æ¸¬æ ¼å¼ä¸ä¸€è‡´**
- `demo` å’Œ `demo2`: YOLO æ¨™æº–æ ¼å¼ (5å€‹å€¼)
- `Regurgitation-YOLODataset-1new`: åˆ†å‰²æ ¼å¼ (å¤šå€‹å€¼)

#### 2. **åˆ†é¡æ ¼å¼ä¸ä¸€è‡´**
- `demo`: ç©ºæ ¼åˆ†éš”æ ¼å¼ (`0 0 1`)
- `demo2`: Python åˆ—è¡¨æ ¼å¼ (`[0, 0, 1]`)
- `Regurgitation-YOLODataset-1new`: æ··åˆæ ¼å¼

#### 3. **é¡åˆ¥æ•¸é‡ä¸åŒ¹é…**
- `demo/demo2`: 2å€‹é¡åˆ¥
- `Regurgitation-YOLODataset-1new`: 4å€‹é¡åˆ¥

### ğŸŸ¡ **æ½›åœ¨å•é¡Œ**

#### 1. **dataloaders3.py è§£æå•é¡Œ**
```python
# ç•¶å‰ä»£ç¢¼å¯èƒ½ç„¡æ³•æ­£ç¢ºè™•ç†ä¸åŒæ ¼å¼
if cl_line.startswith('[') and cl_line.endswith(']'):
    # åªè™•ç† Python åˆ—è¡¨æ ¼å¼
else:
    # åªè™•ç†ç©ºæ ¼åˆ†éš”æ ¼å¼
```

#### 2. **åˆ†é¡å‘é‡é•·åº¦ä¸åŒ¹é…**
- `demo/demo2`: 3å€‹å€¼çš„åˆ†é¡å‘é‡
- `Regurgitation-YOLODataset-1new`: 4å€‹å€¼çš„åˆ†é¡å‘é‡

## å°è¨“ç·´çš„å½±éŸ¿

### 1. **æ•¸æ“šåŠ è¼‰éŒ¯èª¤**
- ä¸åŒæ ¼å¼çš„æ¨™ç±¤æ–‡ä»¶å¯èƒ½å°è‡´è§£æéŒ¯èª¤
- åˆ†é¡æ¨™ç±¤å¯èƒ½è¢«éŒ¯èª¤è§£ææˆ–å¿½ç•¥

### 2. **æ¨¡å‹æ¶æ§‹è¡çª**
- ä¸åŒé¡åˆ¥æ•¸é‡çš„æ•¸æ“šé›†éœ€è¦ä¸åŒçš„æ¨¡å‹é…ç½®
- åˆ†å‰²æ ¼å¼å’Œæ¨™æº– YOLO æ ¼å¼éœ€è¦ä¸åŒçš„è™•ç†æ–¹å¼

### 3. **æå¤±è¨ˆç®—éŒ¯èª¤**
- åˆ†é¡æå¤±å¯èƒ½åŸºæ–¼éŒ¯èª¤çš„æ¨™ç±¤æ•¸æ“š
- æª¢æ¸¬æå¤±å¯èƒ½å—åˆ°æ ¼å¼ä¸ä¸€è‡´çš„å½±éŸ¿

## è§£æ±ºæ–¹æ¡ˆ

### 1. **çµ±ä¸€æ¨™ç±¤æ ¼å¼**

#### æ¨è–¦æ ¼å¼ (ç©ºæ ¼åˆ†éš”):
```
# æª¢æ¸¬æ¨™ç±¤ (YOLO æ¨™æº–æ ¼å¼)
0 0.4765625 0.5875 0.22734375 0.3734375

# åˆ†é¡æ¨™ç±¤ (ç©ºæ ¼åˆ†éš”)
0 0 1
```

### 2. **æ›´æ–° dataloaders3.py**

```python
def create_cl_cache(self, cache_path):
    cl_cache = {}
    
    for lb_file in self.label_files:
        with open(lb_file) as f:
            lines = f.read().strip().splitlines()
            if lines:
                cl_line = lines[-1]
                
                # çµ±ä¸€è™•ç†å…©ç¨®æ ¼å¼
                if cl_line.startswith('[') and cl_line.endswith(']'):
                    try:
                        cl = np.array(ast.literal_eval(cl_line), dtype=np.float32)
                    except:
                        cl = np.array(cl_line.split(), dtype=np.float32)
                else:
                    cl = np.array(cl_line.split(), dtype=np.float32)
                
                cl_cache[lb_file] = cl.tolist()
    
    # ä¿å­˜ç·©å­˜
    cl_cache_path = cache_path.with_name(cache_path.stem + '_cl.cache')
    np.save(cl_cache_path, cl_cache)
```

### 3. **æ•¸æ“šé›†è½‰æ›å·¥å…·**

å‰µå»ºçµ±ä¸€çš„æ ¼å¼è½‰æ›å·¥å…·:
```bash
python yolov5c/utils/format_converter.py \
    --input demo2/train/labels \
    --output demo2/train/labels_converted \
    --format space_separated
```

### 4. **é©—è­‰è…³æœ¬**

```bash
# é©—è­‰è½‰æ›å¾Œçš„æ ¼å¼
python yolov5c/utils/label_analyzer_simple.py \
    --datasets demo demo2_converted Regurgitation-YOLODataset-1new \
    --validate
```

## å»ºè­°çš„è¨“ç·´ç­–ç•¥

### 1. **åˆ†éšæ®µè™•ç†**
```bash
# ç¬¬ä¸€éšæ®µï¼šä½¿ç”¨æ ¼å¼ä¸€è‡´çš„æ•¸æ“šé›†
python train_improved.py \
    --data demo/data.yaml \
    --weights yolov5s.pt \
    --hyp hyp_improved.yaml \
    --epochs 50

# ç¬¬äºŒéšæ®µï¼šè½‰æ›å…¶ä»–æ•¸æ“šé›†æ ¼å¼å¾Œè¨“ç·´
python train_improved.py \
    --data Regurgitation-YOLODataset-1new/data.yaml \
    --weights runs/train/exp/weights/best.pt \
    --hyp hyp_improved.yaml \
    --epochs 50
```

### 2. **æ ¼å¼é©—è­‰**
```bash
# è¨“ç·´å‰é©—è­‰æ ¼å¼
python yolov5c/utils/label_analyzer_simple.py \
    --datasets your_dataset \
    --validate
```

## çµè«–

æ¨™ç±¤æ ¼å¼ä¸ä¸€è‡´æ˜¯å°è‡´åˆ†é¡æå¤±å½±éŸ¿æª¢æ¸¬æº–ç¢ºåº¦çš„æ ¹æœ¬åŸå› ã€‚å»ºè­°ï¼š

1. **ç«‹å³çµ±ä¸€æ‰€æœ‰æ•¸æ“šé›†çš„æ¨™ç±¤æ ¼å¼**
2. **æ›´æ–° dataloaders3.py ä»¥æ­£ç¢ºè™•ç†ä¸åŒæ ¼å¼**
3. **ä½¿ç”¨æ”¹é€²çš„è¨“ç·´è…³æœ¬å’Œè¶…åƒæ•¸**
4. **åœ¨è¨“ç·´å‰é©—è­‰æ•¸æ“šæ ¼å¼ä¸€è‡´æ€§**

é€šéè§£æ±ºé€™äº›æ ¼å¼å•é¡Œï¼Œå¯ä»¥é¡¯è‘—æ”¹å–„æ¨¡å‹çš„è¨“ç·´ç©©å®šæ€§å’Œæª¢æ¸¬æº–ç¢ºåº¦ã€‚ 